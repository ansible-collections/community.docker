---
# Copyright (c) Ansible Project
# GNU General Public License v3.0+ (see LICENSES/GPL-3.0-or-later.txt or https://www.gnu.org/licenses/gpl-3.0.txt)
# SPDX-License-Identifier: GPL-3.0-or-later

- name: Select venv directory
  set_fact:
    docker_compose_venv_root: "{{ remote_tmp_dir }}/docker-compose-venv"

- name: Install docker-compose
  pip:
    state: present
    name: "{{ docker_compose_pip_packages }}"
    extra_args: "-c {{ remote_constraints }}"
    virtualenv: "{{ docker_compose_venv_root }}"
    virtualenv_site_packages: true

- name: Register docker-compose version
  command: "{{ docker_compose_venv_root }}/bin/python -c 'import compose; print(compose.__version__)'"
  register: docker_compose_version
  ignore_errors: true

- name: Declare docker-compose version
  set_fact:
    docker_compose_version: "{{ docker_compose_version.stdout | default('0.0.0') }}"

- name: Declare docker-compose as existing
  set_fact:
    has_docker_compose: true
